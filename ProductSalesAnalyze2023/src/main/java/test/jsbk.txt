// ç·¨è¼¯ç”¢å“ï¼Œå‹•æ…‹æ¸²æŸ“å‰ç«¯ï¼Œå¸¶å…¥æœ‰ä¸Šæ¶çš„å¹³å°é è¨­å€¼æ‰“å‹¾ï¼Œè¿´åœˆç¯„ä¾‹(æ˜¯éŒ¯çš„åªèƒ½è·‘æœ€å¾Œä¸€å€‹)
<div class="form-check">
	<c:forEach items="${product.inventory}" var="stock" varStatus="loop">
	<c:if test="${stock.ecId == 3}">
	<input class="form-check-input" type="checkbox" value="3" id="defaultCheck3_${loop3.index}" checked> 
	</c:if>
	<c:if test="${stock.ecId != 3}">
	<input class="form-check-input" type="checkbox" value="3" id="defaultCheck3_${loop3.index}"> 
	</c:if>
	</c:forEach>
	<label class="form-check-label"	for="defaultCheck3"> è¦çš® </label> 
	<input type="number" class="form-control inventory-field" id="defaultCheck3-inventory" placeholder="åº«å­˜" value="${ product.inventory[2].ecProductQty }">
</div>

//--------------------------------------------------------------------------------------------------
// æ–°å¢ç”¢å“çš„checkbox & radiobutton åˆä½µjsé©—è­‰
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* æé†’å­—æ¨£æ¨£å¼ */
        .error-message {
            color: red;
        }

        /* checkbox æˆ– radio æŒ‰éˆ•éŒ¯èª¤æ™‚çš„æ¨£å¼ */
        .error-input {
            box-shadow: 0 0 5px red;
            border: 2px solid red;
            border-radius: 4px;
            transition: box-shadow 0.3s ease, border 0.3s ease;
        }
    </style>
    <title>Your Page Title</title>
</head>
<body>
    <div class="mb-3">
        <label for="productLaunch" class="form-label">æ˜¯å¦ç«‹å³ä¸Šæ¶</label>
        <div id="error-message" class="error-message" style="display: none;">
            è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é¸é …
        </div>
        <div>
            <input class="checkbox-input error-input" type="checkbox" id="isLaunchCheckbox" value="true">
            <label class="checkbox-label" for="isLaunchCheckbox">ç«‹å³ä¸Šæ¶</label>

            <input class="radio-button-input error-input" type="radio" id="isLaunchTrue" name="isLaunch" value="true" required>
            <label class="radio-button-label" for="isLaunchTrue">æ˜¯</label>

            <input class="radio-button-input error-input" type="radio" id="isLaunchFalse" name="isLaunch" value="false" required>
            <label class="radio-button-label" for="isLaunchFalse">å¦</label>
        </div>
    </div>

    <script>
        document.addEventListener('change', function (event) {
            var target = event.target;
            var errorInputs = document.querySelectorAll('.error-input');

            // éš±è—éŒ¯èª¤æ¶ˆæ¯
            document.getElementById('error-message').style.display = 'none';

            // ç§»é™¤æ‰€æœ‰ checkbox å’Œ radio æŒ‰éˆ•çš„ç´…è‰²å…‰æšˆæ¨£å¼
            errorInputs.forEach(function (input) {
                input.classList.remove('error-input');
            });

            // checkbox æˆ– radio æŒ‰éˆ•è¢«é¸æ“‡æ™‚ï¼Œè§¸ç™¼é©—è­‰å‡½å¼
            if ((target.type === 'checkbox' || target.type === 'radio') && target.classList.contains('error-input')) {
                validateForm();
            }
        });

        function validateForm() {
            var checkboxes = document.querySelectorAll('.checkbox-input');
            var radioButtons = document.getElementsByName('isLaunch');
            var isChecked = false;

            // checkbox é©—è­‰
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    isChecked = true;
                }
            });

            // radio æŒ‰éˆ•é©—è­‰
            for (var i = 0; i < radioButtons.length; i++) {
                if (radioButtons[i].checked) {
                    isChecked = true;
                    break;
                }
            }

            // é¡¯ç¤ºæˆ–éš±è—éŒ¯èª¤æ¶ˆæ¯
            document.getElementById('error-message').style.display = isChecked ? 'none' : 'block';

            return isChecked;
        }
    </script>
</body>
</html>

//-----------------------------------------------------------------------------------------------------------
// å¾Œç«¯è³‡æ–™æ¸²æŸ“åˆ°å‰ç«¯å¾Œï¼Œç”±å‰ç«¯è¨ˆç®—æ‰€éœ€è³‡æ–™åœ¨æ’å…¥è¡¨æ ¼å…§
// ç›¸åŒå“ç‰Œ åˆä½µ éŠ·å”®æ•¸é‡ + éŠ·å”®é¡ + å¹³å°åº«å­˜ + ç¸½åº«å­˜
    let brandGroups = {};
    data.forEach(sale => {
        let brand = sale.brand;
        if (!brandGroups[brand]) {
            brandGroups[brand] = {
                sales: 0,
                salesFigures: 0,
                ecQuantity: 0,
                quantity: 0
            };
        }
        brandGroups[brand].sales += sale.sales;
        brandGroups[brand].salesFigures += sale.salesFigures;
        brandGroups[brand].ecQuantity += sale.ecQuantity;
        brandGroups[brand].quantity += sale.quantity;
    });
    //console.log(analyzeSalesDatas);

    // å°‡è³‡æ–™æ’å…¥è¡¨æ ¼
    Object.keys(brandGroups).forEach(brand => {
    const row = tableBody.insertRow();
    row.insertCell(0).textContent = ''; // æš«æ™‚ä¸è™•ç† number
    row.insertCell(1).textContent = brand;
    row.insertCell(2).textContent = ''; // æš«æ™‚ä¸è™•ç† productDepartment
    row.insertCell(3).textContent = ''; // æš«æ™‚ä¸è™•ç† productType
    row.insertCell(4).textContent = brandGroups[brand].ecQuantity;
    row.insertCell(5).textContent = brandGroups[brand].quantity;
    row.insertCell(6).textContent = brandGroups[brand].sales;
    row.insertCell(7).textContent = brandGroups[brand].salesFigures;
    // æ’å…¥å…¶ä»–æ¬„ä½...

    // è™•ç† date
    const dateCell = row.insertCell(8);
    dateCell.textContent = ''; // æš«æ™‚ä¸è™•ç† date
    dateCell.style.display = 'none'; // éš±è— date æ¬„ä½

    // è™•ç† yoy
    row.insertCell(9).textContent = ''; // æš«æ™‚ä¸è™•ç† yoy
    // æ’å…¥å…¶ä»–æ¬„ä½...
});
    
//-----------------------------------------------------------------------------------------------------------
// æ ¹æ“šç¯©é¸æ¢ä»¶æ›´æ–°è¡¨æ ¼
// salesDataæœ‰å…©å€‹è¡¨æ ¼(æ¨¡å¼)ï¼Œç‚ºäº†è®“å…©å€‹è¡¨æ ¼éƒ½å¯ä»¥æœ‰ç¯©é¸åŠŸèƒ½
function filterData() {
    //const modelSelect = document.getElementById('modelSelect');
    const keyword = document.getElementById('keyword').value.toLowerCase();
    const departmentSelect = document.getElementById('departmentSelect');
    const typeSelect = document.getElementById('typeSelect');
    const brandSelect = document.getElementById('brandSelect');
    // const selectedValue = modelSelect.options[modelSelect.selectedIndex].value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    // ä½¿ç”¨filterå‡½æ•¸ç¯©é¸è³‡æ–™
    const filteredData = salesData.filter(item => {
        //const modelSelectMatch = !modelSelect || item.product.toLowerCase().includes(modelSelect.value.toLowerCase());
        const keywordMatch = !keyword || item.productId.toLowerCase().includes(keyword) || item.productName.toLowerCase().includes(keyword) || item.productEAN.toLowerCase().includes(keyword);
        const departmentSelectMatch = !departmentSelect || item.productDepartment.toLowerCase().includes(departmentSelect.value.toLowerCase());
        const typeSelectMatch = !typeSelect || item.productType.toLowerCase().includes(typeSelect.value.toLowerCase());
        const brandSelectMatch = !brandSelect || item.brand.toLowerCase().includes(brandSelect.value.toLowerCase());
        const dateInRange = (!startDate || item.date >= startDate) && (!endDate || item.date <= endDate);
        // const keywordMatchSelect1 = !modelSelect || item.product.toLowerCase().includes(selectedValue.toLowerCase());
        // const keywordMatch = !keyword1 || item.product.toLowerCase().includes(keyword1);
        //const keywordMatch2 = !keyword || item.code.toString().includes(keyword); //æ•¸å­—çš„å¯«æ³•
        return dateInRange && keywordMatch && departmentSelectMatch && typeSelectMatch && brandSelectMatch;
    });

    // æ›´æ–°è¡¨æ ¼
    initTable(filteredData);
}

function clearFilters() {
    //document.getElementById('modelSelect').selectedIndex = 0;
    document.getElementById('departmentSelect').selectedIndex = 0;
    document.getElementById('typeSelect').selectedIndex = 0;
    document.getElementById('brandSelect').selectedIndex = 0;
    document.getElementById('keyword').value = '';
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
    initTable(salesData);

}

//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------
// POI 
/*
document.getElementById('inputGroupFileAddon04').addEventListener('click', function () {
    var fileInput = document.getElementById('uploadFile');
    var file = fileInput.files[0];

    if (file) {
        var formData = new FormData();
        formData.append('uploadFile', uploadFile);

        fetch('../upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(result => {
            alert(result);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    } else {
        alert('Please choose a file.');
    }
});
*/

/*
//POI2
document.getElementById('excelForm').addEventListener('submit', function (e) {
    e.preventDefault();
    var form = e.target;
    var formData = new FormData(form);

    fetch(form.action, {
        method: form.method,
        body: formData
    })
    .then(response => response.text())
    .then(result => {
        alert(result); // é¡¯ç¤ºå¾å¾Œç«¯æ¥æ”¶åˆ°çš„è¨Šæ¯
    })
    .catch(error => {
        console.error('Error:', error);
    });
});
*/
//------------------------------------------------------------------------------
ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’ğŸ˜’
// å¹³å°è¡¨æ ¼æ‰€æœ‰å‚™ä»½ï¼ŒåŒ¯å‡ºè³‡æ–™(ç¬¬ä¸€ç‰ˆæˆåŠŸï¼Œå‰©å“ç‰Œæ¨¡å¼åŠ ç¸½æ²’è³‡æ–™ï¼ŒåŒ¯å‡ºå•†å“æ˜¯æ‰€æœ‰åŸå§‹è³‡æ–™)

// åˆå§‹åŒ–è¡¨æ ¼ salesTable
let analyzeSalesDatas = [];  // å°‡ analyzeSalesDatas æ”¾åœ¨é€™è£¡å®£å‘Š
function initTable(data) {
    const tableBody = document.getElementById('salesTable').getElementsByTagName('tbody')[0];
    tableBody.innerHTML = ''; // æ¸…ç©ºè¡¨æ ¼

	// ç›¸åŒå‹è™Ÿ åˆä½µ éŠ·å”®æ•¸é‡ + éŠ·å”®é¡
	let productIds = [...new Set(data.map(s => s.productId))];
	analyzeSalesDatas = [];
	for (let productId of productIds) {
	    let salesList = data.filter(s => s.productId === productId);
	    let qty = salesList.reduce((sum, s) => sum + s.sales, 0);
	    let price = salesList.reduce((sum, s) => sum + s.salesFigures, 0);
	    let salesData = { ...salesList[0] }; 
	    salesData.sales = qty;
	    salesData.salesFigures = price;
	    analyzeSalesDatas.push(salesData);
	}
    //console.log(analyzeSalesDatas);

    // å°‡è³‡æ–™æ’å…¥è¡¨æ ¼
    analyzeSalesDatas.forEach(item => {
        const row = tableBody.insertRow();
        row.insertCell(0).textContent = item.number;
        row.insertCell(1).textContent = item.productId;
        row.insertCell(2).textContent = item.productName;
        row.insertCell(3).textContent = item.brand;
        row.insertCell(4).textContent = item.productDepartment;
        row.insertCell(5).textContent = item.productType;
        row.insertCell(6).textContent = item.productEAN;
        row.insertCell(7).textContent = item.ecQuantity;
        row.insertCell(8).textContent = item.quantity;
        row.insertCell(9).textContent = item.sales;
        row.insertCell(10).textContent = item.salesFigures;
        //row.insertCell(11).textContent = item.date;
        const dateCell = row.insertCell(11);
	    dateCell.textContent = item.date;
	    dateCell.style.display = 'none'; // éš±è— date æ¬„ä½
	    
        row.insertCell(12).textContent = item.yoy;
        // æ’å…¥å…¶ä»–æ¬„ä½...
    });
    
    // è™•ç†ç¸½è¨ˆ
    // ç¸½åº«å­˜
    let quantitys = 0;
    analyzeSalesDatas.forEach(item => {
		quantitys += item.quantity;
	});
	document.getElementById('totalQty').innerText = quantitys;
	//ç¸½éŠ·é‡
	let salesQuantitys = 0;
    analyzeSalesDatas.forEach(item => {
		salesQuantitys += item.sales;
	});
	document.getElementById('totalSalesQty').innerText = salesQuantitys;
	//ç¸½éŠ·å”®
	let salesFigures = 0;
    analyzeSalesDatas.forEach(item => {
		salesFigures += item.salesFigures;
	});
	document.getElementById('totalSalesFigures').innerText = salesFigures;
}

//---------------------------------------------------------------------------------------
    /*
    // åˆå§‹åŒ–è¡¨æ ¼ brandSalesTable (ç„¡å“ç‰Œç‰ˆæœ¬)
	let brandGroups = {};
	function initBrandTable(data) {
	    const tableBody = document.getElementById('brandSalesTable').getElementsByTagName('tbody')[0];
	    tableBody.innerHTML = ''; // æ¸…ç©ºè¡¨æ ¼
	
	brandGroups = {};
	
	// ç¢ºä¿ data æ˜¯é™£åˆ—
    if (Array.isArray(data)) {
        // ç›¸åŒå“ç‰Œã€åŒé¤¨åˆ¥ã€åŒåˆ†é¡ åˆä½µ éŠ·å”®æ•¸é‡ + éŠ·å”®é¡ + å¹³å°åº«å­˜ + ç¸½åº«å­˜
        
        data.forEach(sale => {
            let key = `${sale.brand}_${sale.productDepartment}_${sale.productType}`;
            if (!brandGroups[key]) {
                brandGroups[key] = {
                    sales: 0,
                    salesFigures: 0,
                    //ecQuantity: 0,
                    //quantity: 0
                };
            }
            brandGroups[key].sales += sale.sales;
            brandGroups[key].salesFigures += sale.salesFigures;
            //brandGroups[key].ecQuantity += sale.ecQuantity;
            //brandGroups[key].quantity += sale.quantity;
        });

        // å°‡è³‡æ–™æ’å…¥è¡¨æ ¼
        Object.keys(brandGroups).forEach(key => {
            const row = tableBody.insertRow();
            const [brand, department, type] = key.split('_');

            row.insertCell(0).textContent = ''; // æš«æ™‚ä¸è™•ç† number
            row.insertCell(1).textContent = brand;
            row.insertCell(2).textContent = department;
            row.insertCell(3).textContent = type;
            //row.insertCell(4).textContent = '';
            //row.insertCell(5).textContent = '';
            row.insertCell(4).textContent = brandGroups[key].sales;
            row.insertCell(5).textContent = brandGroups[key].salesFigures;
            // æ’å…¥å…¶ä»–æ¬„ä½...

            // è™•ç† date
            const dateCell = row.insertCell(6);
            dateCell.textContent = ''; // æš«æ™‚ä¸è™•ç† date
            dateCell.style.display = 'none'; // éš±è— date æ¬„ä½

            // è™•ç† yoy
            row.insertCell(7).textContent = ''; // æš«æ™‚ä¸è™•ç† yoy
            // æ’å…¥å…¶ä»–æ¬„ä½...
        });
    } else {
        console.error("Data is not an array.");
    }
	
	// è™•ç†ç¸½è¨ˆ
    // ç¸½éŠ·é‡
    let salesQuantitys = 0;
    Object.values(brandGroups).forEach(item => {
        salesQuantitys += item.sales;
    });
    document.getElementById('brandTotalSalesQty').innerText = salesQuantitys;

    // ç¸½éŠ·å”®
    let salesFigures = 0;
    Object.values(brandGroups).forEach(item => {
        salesFigures += item.salesFigures;
    });
    document.getElementById('brandTotalSalesFigures').innerText = salesFigures;

    }*/
    
    // åˆå§‹åŒ–è¡¨æ ¼ brandSalesTable
let brandGroups = {};
function initBrandTable(data) {
    const tableBody = document.getElementById('brandSalesTable').getElementsByTagName('tbody')[0];
    tableBody.innerHTML = ''; // æ¸…ç©ºè¡¨æ ¼

    brandGroups = {};

    // ç¢ºä¿ data æ˜¯é™£åˆ—
    if (Array.isArray(data)) {
        // ç›¸åŒå“ç‰Œã€åŒé¤¨åˆ¥ã€åŒåˆ†é¡ åˆä½µ éŠ·å”®æ•¸é‡ + éŠ·å”®é¡ + å¹³å°åº«å­˜ + ç¸½åº«å­˜

        data.forEach(sale => {
            let key = `${sale.brand}_${sale.productDepartment}_${sale.productType}_${sale.yoy}_${sale.date}`;
            if (!brandGroups[key]) {
                brandGroups[key] = {
                    brand: sale.brand, // æ–°å¢å“ç‰Œè³‡è¨Š
                    department: sale.productDepartment, // æ–°å¢éƒ¨é–€è³‡è¨Š
                    type: sale.productType, // æ–°å¢é¡å‹è³‡è¨Š
                    date: sale.date,
                    sales: 0,
                    salesFigures: 0,
                    yoy: sale.yoy,
                    //ecQuantity: 0,
                    //quantity: 0
                };
            }
            brandGroups[key].sales += sale.sales;
            brandGroups[key].salesFigures += sale.salesFigures;
            //brandGroups[key].ecQuantity += sale.ecQuantity;
            //brandGroups[key].quantity += sale.quantity;
        });

        // å°‡è³‡æ–™æ’å…¥è¡¨æ ¼
        Object.keys(brandGroups).forEach(key => {
            const row = tableBody.insertRow();
            const [brand, department, type, yoy, date] = key.split('_');

            row.insertCell(0).textContent = ''; // æš«æ™‚ä¸è™•ç† number
            row.insertCell(1).textContent = brandGroups[key].brand; // é¡¯ç¤ºå“ç‰Œè³‡è¨Š
            row.insertCell(2).textContent = brandGroups[key].department; // é¡¯ç¤ºéƒ¨é–€è³‡è¨Š
            row.insertCell(3).textContent = brandGroups[key].type; // é¡¯ç¤ºé¡å‹è³‡è¨Š
            //row.insertCell(4).textContent = '';
            //row.insertCell(5).textContent = '';
            row.insertCell(4).textContent = brandGroups[key].sales;
            row.insertCell(5).textContent = brandGroups[key].salesFigures;
            // æ’å…¥å…¶ä»–æ¬„ä½...

            // è™•ç† date
            const dateCell = row.insertCell(6);
            dateCell.textContent = ''; // æš«æ™‚ä¸è™•ç† date
            dateCell.style.display = 'none'; // éš±è— date æ¬„ä½

            // è™•ç† yoy
            row.insertCell(7).textContent = brandGroups[key].yoy; // æš«æ™‚ä¸è™•ç† yoy
            // æ’å…¥å…¶ä»–æ¬„ä½...
        });
    } else {
        console.error("Data is not an array.");
    }

    // è™•ç†ç¸½è¨ˆ
    // ç¸½éŠ·é‡
    let salesQuantitys = 0;
    Object.values(brandGroups).forEach(item => {
        salesQuantitys += item.sales;
    });
    document.getElementById('brandTotalSalesQty').innerText = salesQuantitys;

    // ç¸½éŠ·å”®
    let salesFigures = 0;
    Object.values(brandGroups).forEach(item => {
        salesFigures += item.salesFigures;
    });
    document.getElementById('brandTotalSalesFigures').innerText = salesFigures;
} 
    
//----------------------------------------------------------------------------------   
//è®Šæ›è¡¨æ ¼æ¨¡å¼
function switchTableMode(mode) {
    // éš±è—æ‰€æœ‰è¡¨æ ¼
    document.getElementById('salesTable').style.display = 'none';
    document.getElementById('brandSalesTable').style.display = 'none';

    // æ ¹æ“šæ¨¡å¼é¡¯ç¤ºç›¸æ‡‰è¡¨æ ¼
    if (mode === 'å•†å“') {
        document.getElementById('salesTable').style.display = 'table';
        // åˆå§‹åŒ–å•†å“è¡¨æ ¼
        initTable(salesData);
    } else if (mode === 'å“ç‰Œ') {
        document.getElementById('brandSalesTable').style.display = 'table';
       // åˆå§‹åŒ–å“ç‰Œè¡¨æ ¼ï¼Œç¢ºä¿ data æ˜¯é™£åˆ—
        if (Array.isArray(salesData)) {
            initBrandTable(salesData);
        } else {
            console.error("Data is not an array.");
        }
    }
}

// åœ¨é é¢è¼‰å…¥å®Œæˆå¾Œï¼Œç¶å®šäº‹ä»¶è™•ç†å‡½æ•¸
document.addEventListener('DOMContentLoaded', function () {
    // é è¨­é¡¯ç¤ºå•†å“è¡¨æ ¼
    switchTableMode('å•†å“');
    
    // ç²å–é¸æ“‡æ¡†å…ƒç´ 
    var modeSelect = document.getElementById('modelSelect');

    // ç›£è½é¸æ“‡æ¡†çš„è®ŠåŒ–äº‹ä»¶
    modeSelect.addEventListener('change', function () {
        // ç²å–é¸æ“‡çš„å€¼
        var selectedMode = modeSelect.value;

        // èª¿ç”¨åˆ‡æ›è¡¨æ ¼æ¨¡å¼çš„å‡½æ•¸
        switchTableMode(selectedMode);
    });
});

//-----------------------------------------------------------------------------
// å ±è¡¨åŒ¯å‡ºåŠ ç¸½ç”¨
// è¨ˆç®—åŠ ç¸½
/*
function calculateTotal(data) {
    let total = {
        sales: 0,
        salesFigures: 0,
        // å…¶ä»–åŠ ç¸½é …ç›®...
    };

    if (Array.isArray(data)) {
        data.forEach(item => {
            total.sales += item.sales || 0;
            total.salesFigures += item.salesFigures || 0;
            // å…¶ä»–åŠ ç¸½é …ç›®...
        });

    return total;
	}
}
// ç²å–ç¯©é¸å¾Œçš„è³‡æ–™
//const filteredData = filterData();

// è¨ˆç®—åŠ ç¸½
//const productTotal = calculateTotal(filteredAndMergedData);
const brandTotal = calculateTotal(Object.values(brandGroups));
*/

//-----------------------------------------------------------------------------
// æ ¹æ“šç¯©é¸æ¢ä»¶æ›´æ–°è¡¨æ ¼
/*
function filterData() {
    //const modelSelect = document.getElementById('modelSelect');
    const keyword = document.getElementById('keyword').value.toLowerCase();
    const departmentSelect = document.getElementById('departmentSelect');
    const typeSelect = document.getElementById('typeSelect');
    const brandSelect = document.getElementById('brandSelect');
    // const selectedValue = modelSelect.options[modelSelect.selectedIndex].value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    // ä½¿ç”¨filterå‡½æ•¸ç¯©é¸è³‡æ–™
    const filteredData =  salesData.filter(item => {
        const isProductMode = document.getElementById('modelSelect').value === 'å•†å“';
        const keywordMatch = isProductMode ? (
            !keyword || item.productId.toLowerCase().includes(keyword) || item.productName.toLowerCase().includes(keyword) || item.productEAN.toLowerCase().includes(keyword)
        ) : true;

        const departmentSelectMatch = !departmentSelect || item.productDepartment.toLowerCase().includes(departmentSelect.value.toLowerCase());
        const typeSelectMatch = !typeSelect || item.productType.toLowerCase().includes(typeSelect.value.toLowerCase());
        const brandSelectMatch = !brandSelect || item.brand.toLowerCase().includes(brandSelect.value.toLowerCase());
        const dateInRange = (!startDate || item.date >= startDate) && (!endDate || item.date <= endDate);

        return dateInRange && keywordMatch && departmentSelectMatch && typeSelectMatch && brandSelectMatch;
    });

	 const filteredTotal = calculateTotal(filteredData);

    // æ›´æ–°è¡¨æ ¼
    if (document.getElementById('modelSelect').value === 'å•†å“') {
        initTable(filteredData);
    } else if (document.getElementById('modelSelect').value === 'å“ç‰Œ') {
        initBrandTable(filteredData);
    }
    
    console.log("Filtered Data:", filteredData); // æ–°å¢é€™è¡Œé™¤éŒ¯èªå¥
    console.log("brandGroups:", Object.values(brandGroups));
    //return {filteredDataResult,filteredTotal}; // ç¢ºä¿è¿”å›ä¸€å€‹é™£åˆ—
    return {filteredData, filteredTotal }; // ç¢ºä¿è¿”å›ä¸€å€‹é™£åˆ—
}
*/


function calculateTotal(data) {
    let total = {
        sales: 0,
        salesFigures: 0,
        // å…¶ä»–åŠ ç¸½é …ç›®...
    };

    if (Array.isArray(data)) {
        data.forEach(item => {
            total.sales += item.sales || 0;
            total.salesFigures += item.salesFigures || 0;
            // å…¶ä»–åŠ ç¸½é …ç›®...
        });
    }

    return total;
}
const brandTotal = calculateTotal(Object.values(brandGroups));

// æ–°å¢ä¸€å€‹è®Šæ•¸å­˜å„²ç¶“éç¯©é¸å’Œåˆä½µå¾Œçš„è³‡æ–™
let filteredAndMergedData = [];

function filterAndMergeData() {
    // ç²å–ç¯©é¸å¾Œçš„è³‡æ–™
    const filteredData = salesDatas.filter(item => {
        const isProductMode = document.getElementById('modelSelect').value === 'å•†å“';
        const keywordMatch = isProductMode ? (
            !keyword || item.productId.toLowerCase().includes(keyword) || item.productName.toLowerCase().includes(keyword) || item.productEAN.toLowerCase().includes(keyword)
        ) : true;

        const departmentSelectMatch = !departmentSelect || item.productDepartment.toLowerCase().includes(departmentSelect.value.toLowerCase());
        const typeSelectMatch = !typeSelect || item.productType.toLowerCase().includes(typeSelect.value.toLowerCase());
        const brandSelectMatch = !brandSelect || item.brand.toLowerCase().includes(brandSelect.value.toLowerCase());
        const dateInRange = (!startDate || item.date >= startDate) && (!endDate || item.date <= endDate);

        return dateInRange && keywordMatch && departmentSelectMatch && typeSelectMatch && brandSelectMatch;
    });

    // åœ¨é€™è£¡åŠ å…¥åˆä½µçš„é‚è¼¯ï¼Œä½ å¯ä»¥ä½¿ç”¨é¡ä¼¼ analyzeSalesDatas çš„æ–¹å¼åˆä½µé€™äº›è³‡æ–™
    const productIds = [...new Set(filteredData.map(s => s.productId))];
    const analyzeSalesDatas = [];
    for (const productId of productIds) {
        const salesList = filteredData.filter(s => s.productId === productId);
        const qty = salesList.reduce((sum, s) => sum + s.sales, 0);
        const price = salesList.reduce((sum, s) => sum + s.salesFigures, 0);
        const salesData = { ...salesList[0] };
        salesData.sales = qty;
        salesData.salesFigures = price;
        analyzeSalesDatas.push(salesData);
    }

    // å­˜å„²ç¯©é¸å’Œåˆä½µå¾Œçš„è³‡æ–™
    filteredAndMergedData = analyzeSalesDatas;

    const productTotal = calculateTotal(filteredAndMergedData);

    // æ›´æ–°è¡¨æ ¼
    if (document.getElementById('modelSelect').value === 'å•†å“') {
        initTable(filteredAndMergedData);
    } else if (document.getElementById('modelSelect').value === 'å“ç‰Œ') {
        initBrandTable(filteredAndMergedData);
    }

    // è¿”å›ç¯©é¸å’Œåˆä½µå¾Œçš„è³‡æ–™ï¼Œé€™æ¨£ä½ å¯ä»¥åœ¨åŒ¯å‡ºæ™‚ä½¿ç”¨
    return filteredAndMergedData;
}





function clearFilters() {
    //document.getElementById('modelSelect').selectedIndex = 0;
    document.getElementById('departmentSelect').selectedIndex = 0;
    document.getElementById('typeSelect').selectedIndex = 0;
    document.getElementById('brandSelect').selectedIndex = 0;
    document.getElementById('keyword').value = '';
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
    
    // æ¸…ç©ºè¡¨æ ¼
    if (document.getElementById('modelSelect').value === 'å•†å“') {
        initTable(salesData);
    } else if (document.getElementById('modelSelect').value === 'å“ç‰Œ') {
        initBrandTable(salesData);
    }
}

// åˆå§‹è¼‰å…¥æ™‚é¡¯ç¤ºæ‰€æœ‰è³‡æ–™
initTable(salesData);

//-----------------------------------------------------------------------------------------------
// å ±è¡¨åŒ¯å‡º

// å ±è¡¨åŒ¯å‡º
function exportFilteredDataToExcel() {
    console.log("exportFilteredDataToExcel function called");

    // ç²å–ç¯©é¸ä¸”åˆä½µå¾Œçš„è³‡æ–™
    const filteredAndMergedData = filterAndMergeData();

    console.log("filteredAndMergedData:", filteredAndMergedData);
    console.log("brandGroups:", Object.values(brandGroups));

    // æª¢æŸ¥æ˜¯å¦æœ‰ç¬¦åˆæ¢ä»¶çš„è³‡æ–™
    if (filteredAndMergedData && filteredAndMergedData.length > 0) {
        // å‰µå»ºä¸€å€‹æ–°çš„å·¥ä½œç°¿
        var workbook = XLSX.utils.book_new();

        // æ ¹æ“šç¯©é¸æ¨¡å¼é¸æ“‡åˆå§‹åŒ–å‡½å¼
        if (document.getElementById('modelSelect').value === 'å•†å“') {
            initTable(filteredAndMergedData);
        } else if (document.getElementById('modelSelect').value === 'å“ç‰Œ') {
            initBrandTable(filteredAndMergedData);
        }

        // è¨­å®šåŒ¯å‡ºçš„è³‡æ–™ï¼Œé€™è£¡å‡è¨­ä½ çš„å•†å“æ¨¡å¼çš„è³‡æ–™çµæ§‹åŒ…å«åŠ ç¸½é‡‘é¡
        const exportData = document.getElementById('modelSelect').value === 'å•†å“' ?
            filteredAndMergedData.concat([productTotal])
            : Object.values(brandGroups).concat([brandTotal]);

        // å°‡ç¯©é¸å¾Œçš„è³‡æ–™è½‰æ›æˆå·¥ä½œè¡¨
        var worksheet = XLSX.utils.json_to_sheet(exportData);

        // å°‡å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Filtered Data');

        // å°‡å·¥ä½œç°¿è½‰æ›æˆäºŒé€²åˆ¶æ•¸æ“šï¼ˆBlobï¼‰
        //var blobData = XLSX.write(workbook, { bookType: 'xlsx', type: 'blob', mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

		// å°‡å·¥ä½œç°¿è½‰æ›æˆäºŒé€²åˆ¶æ•¸æ“šï¼ˆBlobï¼‰
	    var blobData = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
	
	    // å°‡ Blob è³‡æ–™è½‰æ›æˆ Blob
	    var blob = new Blob([blobData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

        // å‰µå»ºä¸€å€‹ä¸‹è¼‰é€£çµ
        var link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([blobData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }));


        // è¨­å®šä¸‹è¼‰çš„æª”å
        link.download = 'FilteredData.xlsx';

        // å°‡é€£çµæ·»åŠ åˆ°é é¢ä¸­ä¸¦è§¸ç™¼é»æ“Šäº‹ä»¶
        document.body.appendChild(link);
        link.click();

        // æ¸…ç†
        document.body.removeChild(link);
    } else {
        console.error("No data to export or filteredData is not an array.");
    }

}







/*
function exportFilteredDataToExcel() {
	console.log("exportFilteredDataToExcel function called");
    // ç²å–ç¯©é¸å¾Œçš„è³‡æ–™
    const { filteredData, filteredTotal } = filterData();
    console.log("filteredData:", filteredData);
    console.log("brandGroups:", Object.values(brandGroups));

    // æª¢æŸ¥æ˜¯å¦æœ‰ç¬¦åˆæ¢ä»¶çš„è³‡æ–™
    if (filteredData && filteredData.length > 0) {
		
		
        // å‰µå»ºä¸€å€‹æ–°çš„å·¥ä½œç°¿
        var workbook = XLSX.utils.book_new();

		// æ ¹æ“šç¯©é¸æ¨¡å¼é¸æ“‡åˆå§‹åŒ–å‡½å¼
	    if (document.getElementById('modelSelect').value === 'å•†å“') {
	        initTable(filteredData);
	    } else if (document.getElementById('modelSelect').value === 'å“ç‰Œ') {
	        initBrandTable(filteredData);
	    }
	    
	    // è¨­å®šåŒ¯å‡ºçš„è³‡æ–™ï¼Œé€™è£¡å‡è¨­ä½ çš„å•†å“æ¨¡å¼çš„è³‡æ–™çµæ§‹åŒ…å«åŠ ç¸½é‡‘é¡
    	const exportData = document.getElementById('modelSelect').value === 'å•†å“' ? 
    	filteredData.concat([filteredTotal])
    	: Object.values(brandGroups).concat([brandTotal]);


        // å°‡ç¯©é¸å¾Œçš„è³‡æ–™è½‰æ›æˆå·¥ä½œè¡¨
        var worksheet = XLSX.utils.json_to_sheet(exportData);

        // å°‡å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Filtered Data');

        // å°‡å·¥ä½œç°¿è½‰æ›æˆäºŒé€²åˆ¶æ•¸æ“šï¼ˆBlobï¼‰
        //var blobData = XLSX.write(workbook, { bookType: 'xlsx', type: 'blob', mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

		// å°‡å·¥ä½œç°¿è½‰æ›æˆäºŒé€²åˆ¶æ•¸æ“šï¼ˆBlobï¼‰
	    var blobData = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
	
	    // å°‡ Blob è³‡æ–™è½‰æ›æˆ Blob
	    var blob = new Blob([blobData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

        // å‰µå»ºä¸€å€‹ä¸‹è¼‰é€£çµ
        var link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([blobData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }));


        // è¨­å®šä¸‹è¼‰çš„æª”å
        link.download = 'FilteredData.xlsx';

        // å°‡é€£çµæ·»åŠ åˆ°é é¢ä¸­ä¸¦è§¸ç™¼é»æ“Šäº‹ä»¶
        document.body.appendChild(link);
        link.click();

        // æ¸…ç†
        document.body.removeChild(link);
    } else {
        console.error("No data to export or filteredData is not an array.");
    }
}
*/
//----------------------------------------------------------------------------------------------------------
//goodversion é ç¢¼
<div id="pagination" class="mt-3">
    <nav aria-label="Page navigation example">
	  <ul class="pagination justify-content-end">
	    <li class="page-item">
	      <a class="page-link" href="#" aria-label="Previous">
	        <span aria-hidden="true">&laquo;</span>
	      </a>
	    </li>
	    <li class="page-item"><a class="page-link" href="#">1</a></li>
	    <li class="page-item"><a class="page-link" href="#">2</a></li>
	    <li class="page-item"><a class="page-link" href="#">3</a></li>
	    <li class="page-item">
	      <a class="page-link" href="#" aria-label="Next">
	        <span aria-hidden="true">&raquo;</span>
	      </a>
      	</li>
	  </ul>
	</nav>
</div>









//-----------------------------------------------------------------------------------------------------------
// bootstrapç‰ˆæœ¬
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

